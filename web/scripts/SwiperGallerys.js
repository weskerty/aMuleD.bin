(function(){if(window.__GI)return;window.__GI=true;const DJ='web/Dinamico/data.json';const SW_CDN='https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.';const SW_LOCAL='web/scripts/Otros/Swiper/swiper12-bundle.min.';let SR=false,SL=false,SQ=[];const JC={},SI=new Set();function lS(cb){if(SR){cb();return;}if(SL){SQ.push(cb);return;}SL=true;SQ.push(cb);const c=document.createElement('link');c.rel='stylesheet';c.href=SW_CDN+'css';c.onerror=()=>{c.href=SW_LOCAL+'css'};document.head.appendChild(c);const j=document.createElement('script');j.src=SW_CDN+'js';const d=()=>{SR=true;SQ.forEach(f=>f());SQ=[]};j.onload=d;j.onerror=()=>{const f=document.createElement('script');f.src=SW_LOCAL+'js';f.onload=d;document.head.appendChild(f)};document.head.appendChild(j);}function fN(p){return p.split('/').pop().replace(/\.[^.]+$/,'')}function nN(n){const m=n.match(/NB=([^.]+)/);return m?m[1]:n}function mL(p){return p.replace(/\.[^.]+$/,'.md')}async function lGD(j){if(JC[j]!==undefined)return JC[j];if(JC[j+'_p'])return JC[j+'_p'];const sk='__dj:'+j;try{const sc=sessionStorage.getItem(sk);if(sc){JC[j]=JSON.parse(sc);return JC[j];}}catch(e){}JC[j+'_p']=fetch(j).then(r=>r.json()).then(d=>{JC[j]=d.galleries;try{sessionStorage.setItem(sk,JSON.stringify(d.galleries));}catch(e){}delete JC[j+'_p'];return d.galleries}).catch(e=>{JC[j]=null;delete JC[j+'_p'];return null});return JC[j+'_p'];}function rI(g,k,f){const v=g[k];if(!v)return[];if(Array.isArray(v))return f?v.filter(p=>p.includes('/'+f+'/')):v;if(f&&v[f])return v[f];return Object.values(v).flat();}function cI(p){const n=fN(p);return`<a href="${mL(p)}" class="gallery-item"><img src="${p}" loading="lazy" alt="${nN(n)}"/><div class="menu-content"><p>${nN(n)}</p></div></a>`;}function dS(){SI.forEach(sw=>{if(!document.contains(sw.el)){sw.destroy(true,true);SI.delete(sw);}});}function pC(c){if(c.dataset.sw){return false;}if(!c.parentNode.classList.contains('gl-w')){const w=document.createElement('div');w.className='gl-w';c.parentNode.insertBefore(w,c);w.appendChild(c);}c.classList.add('swiper');c.dataset.sw=1;return true;}function bSC(){return{slidesPerView:'auto',spaceBetween:20,centeredSlides:true,rewind:true,watchSlidesProgress:true,autoplay:{delay:3000,disableOnInteraction:false,pauseOnMouseEnter:true,waitForTransition:true}};}function mSw(c,html,label){c.innerHTML=`<div class="swiper-wrapper">${html}</div>`;const sw=new Swiper(c,bSC());SI.add(sw);}function cSw(c,imgs){if(!pC(c))return;mSw(c,imgs.map(p=>`<div class="swiper-slide">${cI(p)}</div>`).join(''),c.id);}function cG(c,imgs){c.innerHTML=imgs.map(cI).join('');}function cMD(c){const imgs=[...c.querySelectorAll('img')].map(i=>({src:i.src,alt:i.alt||fN(i.src)}));if(!imgs.length)return;if(imgs.length<3){c.innerHTML=imgs.map(i=>`<a href="${i.src}" class="gallery-item" target="_blank"><img src="${i.src}" loading="lazy" alt="${i.alt}"/><div class="menu-content"><p>${i.alt}</p></div></a>`).join('');return;}if(!pC(c))return;mSw(c,imgs.map(i=>`<div class="swiper-slide"><a href="${i.src}" class="gallery-item"><img src="${i.src}" loading="lazy" alt="${i.alt}"/><div class="menu-content"><p>${i.alt}</p></div></a></div>`).join(''),c.id);}async function pCont(c,isSw){const j=c.dataset.jsonPath||DJ,k=c.dataset.galleryKey,f=c.dataset.pathFilter;const key=k||c.id.replace(/-gallery|-grid/g,'');const gd=await lGD(j);if(!gd){c.innerHTML='<p>Error al cargar datos</p>';return;}const imgs=rI(gd,key,f);if(!imgs.length){c.innerHTML='<p></p>';return;}isSw?cSw(c,imgs):cG(c,imgs);}let iGR=false;async function iG(){if(iGR){return;}iGR=true;try{const s=[...document.querySelectorAll('.contenedor-imagenes-animado:not([data-gi])')];const g=[...document.querySelectorAll('.grid-gallery:not([data-gi])')];const m=[...document.querySelectorAll('.galeriaMD:not([data-gi])')];if(!s.length&&!g.length&&!m.length)return;dS();s.forEach(c=>c.dataset.gi=1);g.forEach(c=>c.dataset.gi=1);m.forEach(c=>c.dataset.gi=1);const r=async()=>{for(const c of s)await pCont(c,true);for(const c of g)await pCont(c,false);for(const c of m)cMD(c);};(s.length||m.length)&&!SR?lS(r):await r();}finally{iGR=false;}}document.getElementById('content').addEventListener('contentLoaded',iG);iG();})();